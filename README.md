# Данное руководство находится на доработке! Убедительная просьба воздержаться от выполнения задач
# Грузовики

В данном проекте полная реализация задачи о перевозке железной руды на Урале.
Репозиторий будет постоянно обновляться.

## Общая информация

### Разделение задания на подзадачи

1. Реализация SystemFile;
2. Реализация программы, исполняющей роль одного самосвала (далее - Самосвал);
3. Реализация программы, исполняющей роль регулировщика с одной стороны моста (далее - Регулироввщик);
4. Реализация программы, отвечающей за запуск потоков регулировщиков и самосвалов (далее - Инициализатор).

### Используемые инструменты

1. Очереди сообщений для сообщения регулировщикам о прибытии самосвала;
2. Семафоры для передачи самосвалам разрешения на проезд.

### Возможные события

1. У моста нет самосвалов;
2. С одной стороны моста нет самосвалов;
3. Самосвалы есть по обе стороны моста;
4. Прибыл самосвал недопустимого веса.

### Упрощенная задача

1. Все самосвалы одного веса;
2. Регулировщик допускает на мосту наличие только одного самосвала.

### Распределение между участниками группы

1. Шоислом;
2. Вальтер;
3. Глеб;
4. Аян.

## Межпроцессное взаимодействие

### 1. Введение в методы взаимодействия в данной задаче
1. #### Очереди сообщений
   1. Самосвал - Регулировщик:
      * Регулировщик выступает выступает в качестве сервера, Самосвал - в качестве клиента;
      * Самосвал посылает сообщение Регулировщику, расположенному с ним по одну сторону моста, после подъезда к мосту, а Регулировщик принимает его.
2. #### Семафоры
   1. Самосвал - Регулировщик:
      1. Пропускающий семафор:
         * Регулировщик разрешает Самосвалу проезд по мосту, устанавливая заданное значение семафора;
         * После проезда по мосту Самосвал меняет значение семафора на исходное (исходное значение == 0).
      2. Завершающий семафор:
         * Завершить работу при значении 0.
   2. Регулировщик - Регулировщик:
      1. Операционный семафор:
         * Применяется для определения того, какой Регулировщик руководит движением на мосту в данный момент.
      2. Завершающий семафор:
         * Завершить работу при значении 0.

### 2. Необходимые данные для корректного взаимодействия, содержащиеся в процессах
1. #### Самосвал
   * Номер семафора в массиве семафоров самосвалов и семафор самосвалов;
   * Ключ семафора завершения;
   * Ключ очереди сообщений первого и второго регулировщиков;
   * Масса самосвала;
   * Расположение самосвала относительно моста.
2. #### Регулировщик
   * Собственный ключ очереди сообщений;
   * (Собственный) Ключ семафора регулировщиков;
   * Ключ массива семафоров самосвалов;
   * Ключ семафора завершения;
   * Расположение регулировщика относительно моста ({0, 2}).

### 3. Порядок взаимодействия с "соседними" процессами
1. #### Самосвал - Регулировщик
   1. После подъезда к мосту Самосвал посылает соответствующему Регулировщику сообщение по форме ```"Номер Самосвала" "Масса Самосвала"```, а затем ждёт разрешение на проезд от Регулировщика;
   2. Если Регулировщик разрешает Самосвалу движение по мосту, то меняет значение его семафора на 1 (увеличивает на 1);
   3. Самосвал устанавливает значение собственного семафора на 0; 
   4. После выезда с моста Самосвал меняет значение семафора на 1 (добавляет 1) и ждёт, пока Регулировщик не установит значение 0;
   5. Регулировщик меняет значение семафора Самосвала на 0 (уменьшает на 1);
   6. Регулировщик уменьшает значение завершающего на 1;
2. #### Регулировщик - Регулировщик
   1. Для передачи управления движением Регулировщик меняет значение семафора на номер другого регулировщика, а затем ждёт, пока семафор не примет значение, соответствующее его номеру.

# Требования к реализации программ (задач)
### 1. Инициализатор
1. Реализация в файле ```initialization.cpp```;
2. Использование ```fork()``` для создания процессов;
3. Перед тем, как запустить дочерние процессы, Инициализатор создаёт ключи для очередей сообщений обеих регулировщиков,
   ключ завершающего, ключ семафора регулировщиков, ключ семафора самосвалов;
4. Для запуска процессов инициализатор использует функции из ```initialization.hpp```;
5. Программа логирует все свои действия в заданную директорию в файл с названием ```LogInitializator.txt```.

### 2. Самосвал
1. Объявление класса ```Truck``` в файле ```truck.hpp```;
2. Реализация в файле ```truck.cpp```;
3. Для создания нового самосвала-процесса создаётся объект класса ```Truck``` и вызывается метод ```StartProcess```;
4. Программа логирует все свои действия в заданную директорию в файл с названием ```LogTruck"номер самосвала(ключ семафора)".txt```;
5. Конструктор создаёт (если возможно) семафор самосвалов.

### 3. Регулировщик
1. Объявление класса ```TrafficController``` в файле ```traffic_controller.hpp```;
2. Реализация в файле ```traffic_controller.cpp```;
3. Для создания нового регулировщика-процесса cоздаётся объект класса ```TrafficController``` и вызывается метод ```StartProcess```;
4. Программа логирует все свои действия в заданную директорию в файл с названием ```LogTrafficController"расположение регулировщика".txt```;
5. Конструктор создаёт очередь сообщений регулировщика, (если возможно) семафор регулировщиков, семафор,
определяющий количество самосвалов, семафор завершения.

# Критерий завершение работы
1. Самосвал завершает работу, если значение завершающего семафора == 0;
2. Регулировщик завершает работу, если по мосту проехало заданное количество самосвалов, либо если значение завершающего
семафора == 0. При завершении работы устанавливает значение завершающего семафора = 0 (если оно уже не было
установлено), если в очереди к семафору стоят самосвалы, то он разрешает им проезд (чтобы у самосвала была возможность
проверить семафор завершения);
3. Инициализатор завершает работу, когда работу завершили все Регулировщики..